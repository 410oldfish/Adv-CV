import os
import random
import numpy as np
import torch
from vit_pytorch.efficient import ViT
from linformer import Linformer

device = 'cuda' if torch.cuda.is_available() else 'cpu'

# Training hyperparameters
batch_size = 64
test_batch_size = 64
epochs = 100
lr = 3e-5
gamma = 0.7
seed = 42

# Model
def build_model():
    efficient_transformer = Linformer(
        dim=128,
        seq_len=16+1,
        depth=12,
        heads=8,
        k=64
    )
    model = ViT(
        dim=128,
        image_size=32,
        patch_size=8,
        num_classes=2,
        transformer=efficient_transformer,
        channels=3,
    ).to(device)
    return model

def seed_everything(seed: int = 42):
    random.seed(seed)
    os.environ['PYTHONHASHSEED'] = str(seed)
    np.random.seed(seed)
    torch.manual_seed(seed)
    torch.cuda.manual_seed(seed)
    torch.cuda.manual_seed_all(seed)
    torch.backends.cudnn.deterministic = True
    print(f"✅ Random seed set to {seed}")
